import json
import re

# API response data with all neighborhoods
api_data = {
  "total_count": 22,
  "results": [
    {"name": "Arbutus Ridge", "geom": {"geometry": {"coordinates":[[[-123.15259552001952,49.25722503568872],[-123.16487884521484,49.257427214643805],[-123.16487884521484,49.25756835844264],[-123.17807006835938,49.25776672270045],[-123.1781005859375,49.257164000532484],[-123.17792510986328,49.2569389333938],[-123.17616271972656,49.25561141874535],[-123.1750106811523,49.25408172514183],[-123.17190551757812,49.25155258085472],[-123.1696014404297,49.24896240141134],[-123.17092895507812,49.24967193510274],[-123.17218780517578,49.250045775434785],[-123.17095184326172,49.24845886137228],[-123.17056274414061,49.24811935331564],[-123.17015838623047,49.24788284208516],[-123.17024993896484,49.234703063032356],[-123.15527343750001,49.23452377226088],[-123.15508270263673,49.23939895536637],[-123.15506744384766,49.23947906400897],[-123.15503692626955,49.239562987348805],[-123.15500640869139,49.23964309599139],[-123.15496826171876,49.239723204633954],[-123.15492248535156,49.23979949857926],[-123.15487670898438,49.239879607221845],[-123.15481567382812,49.2399520864699],[-123.15475463867189,49.24002456571794],[-123.1546859741211,49.24009704496598],[-123.15461730957031,49.24016570951677],[-123.15453338623045,49.240230559370296],[-123.15444946289062,49.24029159452653],[-123.15435791015625,49.24035262968279],[-123.15426635742188,49.240406035444494],[-123.15416717529297,49.24045944120622],[-123.15406036376952,49.240509032270694],[-123.15396118164062,49.24055480863786],[-123.15384674072266,49.24059677030778],[-123.15373229980467,49.24063491728044],[-123.15361785888673,49.240669249555836],[-123.1534957885742,49.24069976713394],[-123.15337371826172,49.24072647001482],[-123.15325164794922,49.24074935819841],[-123.15312957763672,49.24076461698747],[-123.15299987792967,49.240776061079266],[-123.15287780761719,49.240787505171056],[-123.15274810791016,49.240791319868336],[-123.15261840820311,49.240791319868336],[-123.15249633789062,49.240783690473805],[-123.15236663818361,49.24077606107926],[-123.15223693847656,49.24076080229022],[-123.15211486816406,49.24074554350114],[-123.15199279785156,49.24072265531754],[-123.1500701904297,49.24038696195817],[-123.14994049072266,49.240367888471845],[-123.14981842041016,49.240352629682775],[-123.14968872070311,49.24034118559099],[-123.1495590209961,49.24033737089373],[-123.14942932128905,49.24033355619646],[-123.14929962158203,49.24033737089373],[-123.14916992187499,49.24034118559099],[-123.14904022216797,49.24035262968279],[-123.14891815185547,49.24036788847185],[-123.14878845214842,49.24039077665544],[-123.14866638183594,49.24041366483903],[-123.14854431152344,49.2404403677199],[-123.14842224121094,49.240474699995275],[-123.14830780029297,49.24051284696796],[-123.148193359375,49.24055099394059],[-123.14808654785158,49.24059677030778],[-123.14797973632812,49.24064636137223],[-123.1478729248047,49.240695952436695],[-123.14777374267577,49.24075317289568],[-123.14768218994142,49.24081039335467],[-123.14759063720705,49.24087142851091],[-123.14750671386719,49.240936278364416],[-123.14743041992188,49.24100494291521],[-123.1473617553711,49.241073607465985],[-123.14729309082031,49.24114608671403],[-123.14723205566405,49.24122238065935],[-123.14717864990234,49.241298674604664],[-123.14712524414062,49.24137496854999],[-123.14708709716795,49.24145507719255],[-123.14704895019533,49.24153900053239],[-123.14701843261717,49.241619109174984],[-123.14699554443358,49.24170303251482],[-123.14698028564453,49.24178695585467],[-123.14697265624999,49.241870879194515],[-123.14696502685547,49.24195480253437],[-123.14694976806642,49.2425613393996],[-123.14694976806642,49.24273300077653],[-123.14697265624999,49.242900847456234],[-123.14700317382812,49.243072508833194],[-123.14704895019533,49.243240355512874],[-123.14710235595703,49.24340438749529],[-123.14717864990234,49.243568419477725],[-123.14726257324219,49.24372863676288],[-123.14736938476562,49.24388503935077],[-123.15238189697264,49.250621794721894],[-123.1524658203125,49.25074767973165],[-123.15254211425781,49.2508773794387],[-123.1526107788086,49.251007079145715],[-123.15266418457031,49.25114059355003],[-123.1527099609375,49.25127792265159],[-123.15274047851561,49.25141525175315],[-123.1527633666992,49.25155258085472],[-123.15277099609375,49.25169372465353],[-123.1527633666992,49.25183105375512],[-123.15259552001952,49.25722503568872]]],"type":"Polygon"}}, "geo_point_2d": {"lon": -123.16166923820482, "lat": 49.24680490982789}},
    # ... More will be added programmatically
  ]
}

def slug_from_name(name):
    """Convert neighborhood name to slug"""
    return re.sub(r'[^a-z0-9]+', '-', name.lower()).strip('-')

# Start generating the TypeScript file
output = """import { VANCOUVER_CENTER } from './mapbox';
import type { Neighborhood, NeighborhoodProperties } from '../types/neighborhood';

export const NEIGHBORHOODS: GeoJSON.FeatureCollection<GeoJSON.Polygon, NeighborhoodProperties> = {
  type: "FeatureCollection",
  features: [
"""

# Process each neighborhood
for i, neighborhood in enumerate(api_data["results"]):
    name = neighborhood["name"]
    coords = neighborhood["geom"]["geometry"]["coordinates"]
    center = [neighborhood["geo_point_2d"]["lon"], neighborhood["geo_point_2d"]["lat"]]
    slug = slug_from_name(name)
    
    # Format coordinates as a string
    coords_str = json.dumps(coords)
    
    # Add feature
    output += f"""    {{
      type: "Feature",
      properties: {{
        id: {i + 1},
        name: "{name}",
        slug: "{slug}",
        center: [{center[0]}, {center[1]}]
      }},
      geometry: {{
        type: "Polygon",
        coordinates: {coords_str}
      }}
    }}{',' if i < len(api_data["results"]) - 1 else ''}
"""

# Close the file
output += """  ]
};

// Helper functions
export function getNeighborhoodBySlug(slug: string): Neighborhood | undefined {
  return NEIGHBORHOODS.features.find(
    (f) => f.properties.slug === slug
  ) as Neighborhood | undefined;
}

export function getNeighborhoodCenter(slug: string): [number, number] {
  const neighborhood = getNeighborhoodBySlug(slug);
  return neighborhood?.properties.center || VANCOUVER_CENTER;
}

export function getAllNeighborhoodNames(): string[] {
  return NEIGHBORHOODS.features.map((f) => f.properties.name);
}
"""

# Write to file
with open('neighborhoods_generated.ts', 'w') as f:
    f.write(output)

print("âœ… Generated neighborhoods_generated.ts")
print(f"ðŸ“Š Processed {len(api_data['results'])} neighborhoods")
